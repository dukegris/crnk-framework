package io.crnk.gen.openapi;

import io.swagger.v3.oas.models.OpenAPI;
import org.apache.commons.io.FileUtils;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;

public class OpenAPIGeneratorConfigTest {
  @BeforeEach
  public void setup() throws IOException {
    File buildDir = new File("build/tmp/openapi");

    InputStream xmlDoc = getClass().getClassLoader().getResourceAsStream("openapi-template.yml");
    FileUtils.copyInputStreamToFile(xmlDoc, new File(buildDir, "openapi-template.yml"));
  }

  @Test
  public void test() {
    OpenAPIGeneratorConfig config = new OpenAPIGeneratorConfig();

    // Default
    OpenAPI openApi = config.getOpenAPI();
    Assertions.assertSame("Generated Title", openApi.getInfo().getTitle());
    Assertions.assertSame("0.1.0", openApi.getInfo().getVersion());
    Assertions.assertSame("Generated Description", openApi.getInfo().getDescription());

    config.setProjectName("My custom title");
    Assertions.assertEquals("My custom title", config.getProjectName());

    config.setProjectVersion("7.7.7");
    Assertions.assertEquals("7.7.7", config.getProjectVersion());

    config.setProjectDescription("My custom description");
    Assertions.assertEquals("My custom description", config.getProjectDescription());

    Assertions.assertEquals(OutputFormat.YAML, config.getOutputFormat(), "Defaults to YAML");
    config.setOutputFormat(OutputFormat.JSON);
    Assertions.assertEquals(OutputFormat.JSON, config.getOutputFormat());

    Assertions.assertFalse(config.getOutputSorted(), "Defaults to false");
    config.setOutputSorted(true);
    Assertions.assertTrue(config.getOutputSorted());

    openApi = config.getOpenAPI();
    Assertions.assertSame("My custom title", openApi.getInfo().getTitle());
    Assertions.assertSame("7.7.7", openApi.getInfo().getVersion());
    Assertions.assertSame("My custom description", openApi.getInfo().getDescription());

    File buildDir = new File("build/tmp/openapi");
    config.setBuildDir(buildDir);
    Assertions.assertSame(buildDir, config.getBuildDir());
    config.setTemplateName("openapi-template.yml");
    Assertions.assertSame("openapi-template.yml", config.getTemplateName());

    openApi = config.getOpenAPI();
    Assertions.assertEquals("Title From Template", openApi.getInfo().getTitle());
    Assertions.assertEquals("0.1.0", openApi.getInfo().getVersion());
    Assertions.assertEquals("OpenAPI document with autogenerated paths, components, responses, etc.", openApi.getInfo().getDescription());
  }
}
